<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom | Code With Pritom</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <!-- Auth Guard -->
    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script>if (!Auth.isLoggedIn()) window.location.href = 'index.html';</script>
</head>

<body class="bg-gray-900 text-white h-screen flex flex-col overflow-hidden font-['Inter'] antialiased">

    <!-- ===================== HEADER ===================== -->
    <header
        class="classroom-header flex justify-between items-center px-4 py-3 bg-gray-800 border-b border-gray-700 z-50 relative">
        <div class="flex items-center gap-3">
            <a href="dashboard.html"
                class="w-8 h-8 flex items-center justify-center bg-gray-700/60 rounded-lg hover:bg-gray-600 transition text-sm text-gray-300">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
            <div class="truncate max-w-[150px] sm:max-w-xs">
                <h1 id="course-title" class="font-bold text-sm tracking-wide text-white truncate">Loading...</h1>
                <p id="course-meta" class="text-xs text-gray-400 truncate hidden sm:block">â€”</p>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <!-- Mobile Sidebar Toggle -->
            <button onclick="toggleClassroomSidebar()"
                class="btn btn-sm btn-dark md:hidden flex items-center gap-2 border border-gray-600">
                <i class="fa-solid fa-list-ul"></i>
                <span class="hidden sm:inline">Lessons</span>
            </button>

            <!-- Cart Trigger -->
            <div class="cart-trigger" onclick="Cart.toggleCart()">
                <i class="fa-solid fa-cart-shopping text-lg"></i>
                <div id="cart-badge-count" class="cart-badge" style="display:none">0</div>
            </div>

            <!-- Course Progress Badge (Desktop) -->
            <div id="course-progress-badge"
                class="hidden md:flex items-center gap-2 bg-gray-700/50 rounded-lg px-3 py-1.5">
                <div class="w-16 h-1.5 bg-gray-600 rounded-full overflow-hidden">
                    <div id="header-progress-bar" class="h-full bg-green-500 rounded-full transition-all duration-500"
                        style="width:0%"></div>
                </div>
                <span id="header-progress-text" class="text-xs text-gray-400 font-bold">0%</span>
            </div>

            <span id="lesson-counter" class="text-xs text-gray-400 hidden lg:inline">Lesson 1 of 1</span>

            <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg text-white flex items-center justify-center font-bold text-sm shadow-lg"
                id="cl-user-initial">U</div>
        </div>
    </header>

    <!-- Mobile Sidebar Overlay -->
    <div id="classroom-sidebar-overlay" class="classroom-sidebar-overlay md:hidden" onclick="closeClassroomSidebar()">
    </div>

    <!-- ===================== MAIN LAYOUT ===================== -->
    <div class="flex flex-1 overflow-hidden">
        <!-- Video + Complete Section -->
        <div class="flex-1 flex flex-col">
            <!-- Video Player Area -->
            <div class="classroom-video-area">
                <div id="video-loader" class="absolute inset-0 flex items-center justify-center z-0">
                    <div class="flex flex-col items-center gap-3">
                        <div class="spinner" style="border-color:#334155;border-top-color:#f97316"></div>
                        <span class="text-sm text-gray-500">Loading video...</span>
                    </div>
                </div>
                <div id="video-wrapper"
                    class="w-full max-w-5xl aspect-video bg-black z-10 shadow-2xl rounded-lg overflow-hidden"></div>

                <!-- Lock Screen -->
                <div id="lock-screen"
                    class="hidden absolute inset-0 bg-gray-900/95 backdrop-blur-sm z-20 flex flex-col items-center justify-center">
                    <div class="bg-gray-800 p-10 rounded-2xl shadow-2xl text-center max-w-md border border-gray-700">
                        <div
                            class="w-20 h-20 bg-red-500/10 rounded-2xl flex items-center justify-center mx-auto mb-6 text-red-500">
                            <i class="fa-solid fa-lock text-3xl"></i>
                        </div>
                        <h2 class="text-2xl font-extrabold mb-3">Access Denied</h2>
                        <p class="text-gray-400 mb-8 text-sm leading-relaxed">You haven't enrolled in this course yet.
                            Purchase it to unlock all lessons.</p>
                        <button onclick="Cart.addItem(courseDB[courseId])" class="btn btn-primary btn-lg btn-pill">
                            <i class="fa-solid fa-cart-plus text-sm"></i> Add to Cart
                        </button>
                    </div>
                </div>
            </div>

            <!-- âœ… COMPLETE BAR (Below Video) -->
            <div id="complete-bar" class="complete-bar" style="display:none">
                <div class="flex items-center gap-3">
                    <button id="btn-mark-complete" onclick="markComplete()" class="btn-complete">
                        <i class="fa-solid fa-check-circle"></i>
                        <span id="complete-btn-text">Mark as Complete</span>
                    </button>
                    <span id="complete-status" class="text-xs text-gray-500 hidden sm:inline"></span>
                </div>
                <div class="flex items-center gap-2">
                    <button id="btn-prev-lesson" onclick="prevLesson()" class="btn-next" style="display:none">
                        <i class="fa-solid fa-chevron-left text-xs"></i> Previous
                    </button>
                    <button id="btn-next-lesson" onclick="nextLesson()" class="btn-next" style="display:none">
                        Next <i class="fa-solid fa-chevron-right text-xs"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- ===================== SIDEBAR ===================== -->
        <aside id="classroom-sidebar" class="classroom-sidebar dark-scroll">
            <div class="p-5 border-b border-gray-700">
                <h3 class="font-bold text-gray-300 uppercase text-xs tracking-wider mb-1">Course Content</h3>
                <p id="sidebar-course-title" class="text-sm text-gray-500 truncate">â€”</p>
                <!-- Progress in Sidebar -->
                <div class="inline-progress mt-3">
                    <div class="inline-progress-bar">
                        <div id="sidebar-progress-fill" class="inline-progress-fill" style="width:0%"></div>
                    </div>
                    <span id="sidebar-progress-text" class="text-xs text-gray-400 font-bold whitespace-nowrap">0%</span>
                </div>
            </div>

            <div id="lesson-list" class="flex-1 overflow-y-auto py-2"></div>

            <!-- Hand Notes Section -->
            <div id="handnotes-section" class="border-t border-gray-700 p-4 hidden">
                <h4 class="font-bold text-xs text-gray-400 uppercase tracking-wider mb-3">
                    <i class="fa-solid fa-file-pdf mr-1 text-red-500"></i> Hand Notes
                </h4>
                <div id="handnotes-list"></div>
            </div>

            <!-- Quick Notes -->
            <div class="border-t border-gray-700 p-4">
                <h4 class="font-bold text-xs text-gray-400 uppercase tracking-wider mb-3">
                    <i class="fa-solid fa-sticky-note mr-1 text-yellow-500"></i> My Notes
                </h4>
                <textarea id="lesson-notes"
                    class="w-full bg-gray-800 text-gray-300 border border-gray-700 rounded-lg p-3 text-sm resize-none outline-none focus:border-orange-500 transition"
                    rows="4" placeholder="Type personal notes..."></textarea>
                <button onclick="saveNotes()"
                    class="mt-2 text-xs text-orange-500 font-bold hover:text-orange-400 transition">
                    <i class="fa-solid fa-floppy-disk mr-1"></i> Save Note
                </button>
            </div>
        </aside>
    </div>

    <!-- ===================== CART PANEL ===================== -->
    <div id="cart-overlay" class="cart-overlay" onclick="Cart.closeCart()"></div>
    <div id="cart-panel" class="cart-panel">
        <div class="cart-header">
            <h3 class="font-bold text-slate-800">Your Cart</h3>
            <button onclick="Cart.closeCart()" class="text-slate-400 hover:text-slate-600"><i
                    class="fa-solid fa-xmark text-xl"></i></button>
        </div>

        <div id="cart-items-list" class="cart-items">
            <!-- Items injected here -->
        </div>

        <div id="cart-empty" class="p-8 text-center text-slate-400 hidden">
            <i class="fa-solid fa-cart-shopping text-4xl mb-4 opacity-50"></i>
            <p>Your cart is empty.</p>
        </div>

        <div id="cart-content" class="cart-footer">
            <div class="cart-total-row final">
                <span>Total</span>
                <span id="cart-subtotal">$0.00</span>
            </div>
            <button onclick="Cart.openCheckout()" class="btn btn-primary w-full mt-4">
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- ===================== CHECKOUT MODAL ===================== -->
    <div id="checkout-modal-overlay" class="modal-backdrop" onclick="Cart.closeCheckout()"></div>
    <div id="checkout-modal" class="modal-container checkout-modal">
        <div class="checkout-header">
            <h2 class="font-bold text-lg text-slate-800">Secure Checkout</h2>
            <div class="stepper checkout-steps">
                <div class="step-indicator checkout-step active">
                    <div class="step-circle">1</div>
                    <div class="step-label">Cart</div>
                </div>
                <div class="step-indicator checkout-step">
                    <div class="step-circle">2</div>
                    <div class="step-label">Info</div>
                </div>
                <div class="step-indicator checkout-step">
                    <div class="step-circle">3</div>
                    <div class="step-label">Pay</div>
                </div>
                <div class="step-indicator checkout-step">
                    <div class="step-circle">4</div>
                    <div class="step-label">Done</div>
                </div>
            </div>
            <button onclick="Cart.closeCheckout()" class="text-slate-400 hover:text-slate-600"><i
                    class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="checkout-body">
            <!-- Step 1: Summary -->
            <div id="checkout-step-1" class="checkout-section active">
                <h3 class="font-bold text-slate-700 mb-4">Order Summary</h3>
                <div id="checkout-cart-list" class="bg-white p-4 rounded-lg border border-gray-100 mb-6"></div>
                <div class="flex justify-between font-bold text-lg">
                    <span>Total To Pay</span>
                    <span class="checkout-total">$0.00</span>
                </div>
                <div class="mt-8 flex justify-end">
                    <button onclick="Cart.setStep(2)" class="btn btn-primary">
                        Continue to Billing <i class="fa-solid fa-arrow-right ml-2 text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Billing -->
            <div id="checkout-step-2" class="checkout-section">
                <div class="checkout-grid">
                    <div class="checkout-form-card">
                        <h3 class="font-bold text-slate-700 mb-4">Billing Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-group col-span-2 md:col-span-1">
                                <label class="form-label">Full Name</label>
                                <input type="text" id="bill-name" class="form-input" required>
                            </div>
                            <div class="form-group col-span-2 md:col-span-1">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" id="bill-phone" class="form-input" placeholder="017..." required>
                            </div>
                            <div class="form-group col-span-2">
                                <label class="form-label">Email Address</label>
                                <input type="email" id="bill-email" class="form-input" required>
                            </div>
                            <div class="form-group col-span-2">
                                <label class="form-label">Street Address</label>
                                <input type="text" id="bill-address" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">City</label>
                                <input type="text" id="bill-city" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Postal Code</label>
                                <input type="text" id="bill-zip" class="form-input" required>
                            </div>
                            <div class="form-group col-span-2">
                                <label class="form-label">Country</label>
                                <input type="text" id="bill-country" class="form-input" value="Bangladesh" readonly>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="bg-slate-50 p-6 rounded-xl border border-dashed border-slate-300">
                            <h4 class="font-bold text-slate-600 mb-2">Total Amount</h4>
                            <div class="text-3xl font-black text-slate-900 checkout-total">$0.00</div>
                            <p class="text-xs text-slate-400 mt-2">Next step: Payment & Promo</p>
                        </div>
                        <div class="mt-4 flex flex-col gap-3">
                            <button onclick="Cart.setStep(3)" class="btn btn-primary w-full">Next Step</button>
                            <button onclick="Cart.setStep(1)" class="btn btn-outline w-full">Back</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Promo & Payment -->
            <div id="checkout-step-3" class="checkout-section">
                <div class="checkout-grid">
                    <div>
                        <!-- Promo Code -->
                        <div class="bg-white p-4 rounded-lg border border-gray-100 mb-6 flex gap-2">
                            <input type="text" id="promo-code-input" class="form-input"
                                placeholder="Have a promo code?">
                            <button onclick="Cart.applyPromo()" class="btn btn-dark">Apply</button>
                        </div>
                        <div id="promo-feedback" class="mb-4"></div>

                        <!-- bKash -->
                        <div class="bkash-box">
                            <div class="font-bold text-xl mb-1">bKash Payment</div>
                            <p class="text-sm opacity-90 mb-4">Send Money to Merchant</p>
                            <div
                                class="text-2xl font-black bg-white/20 rounded-lg py-2 mb-2 flex items-center justify-center">
                                01853343176
                                <button id="btn-copy-bkash" onclick="Cart.copyBkash()" class="copy-btn">Copy</button>
                            </div>
                            <p class="text-xs opacity-80">Reference: Your Name</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Enter Transaction ID (TrxID)</label>
                            <input type="text" id="bkash-txn-input"
                                class="form-input text-center text-lg tracking-widest font-mono uppercase"
                                placeholder="8X20B9..." required>
                            <p class="text-xs text-slate-500 mt-1">You must complete the bKash transfer first.</p>
                        </div>
                    </div>

                    <div>
                        <div class="bg-slate-50 p-6 rounded-xl">
                            <h4 class="font-bold text-slate-600 mb-4 border-b pb-2">Final Summary</h4>
                            <div class="flex justify-between mb-2 text-sm text-slate-500">
                                <span>Subtotal</span>
                                <span class="checkout-subtotal">$0.00</span>
                            </div>
                            <div id="checkout-discount-row"
                                class="flex justify-between mb-2 text-sm text-green-600 font-bold hidden">
                                <span>Discount</span>
                                <span id="checkout-discount-amount">-$0.00</span>
                            </div>
                            <div
                                class="flex justify-between mt-4 pt-4 border-t border-slate-200 text-xl font-black text-slate-900">
                                <span>Total</span>
                                <span class="checkout-total">$0.00</span>
                            </div>
                        </div>
                        <div class="mt-4 flex flex-col gap-3">
                            <button id="btn-place-order" onclick="Cart.submitOrder()"
                                class="btn btn-primary w-full shadow-lg hover:shadow-orange-500/20">
                                Place Order (Verify)
                            </button>
                            <button onclick="Cart.setStep(2)" class="btn btn-outline w-full">Back</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Success -->
            <div id="checkout-step-4" class="checkout-section text-center pt-10">
                <div
                    class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-500 animate-bounce">
                    <i class="fa-solid fa-check text-4xl"></i>
                </div>
                <h2 class="text-3xl font-black text-slate-800 mb-4">Order Placed!</h2>
                <p class="text-slate-500 max-w-md mx-auto mb-8">
                    Your order <span id="conf-order-id" class="font-mono font-bold text-slate-800">#...</span> has been
                    received.
                    <br><br>
                    We are verifying your bKash payment. You will receive an email confirmation and course access within
                    <strong>2 hours</strong>.
                </p>
                <div class="flex justify-center gap-4">
                    <button onclick="window.location.href='dashboard.html'" class="btn btn-primary btn-lg">Go to
                        Dashboard</button>
                </div>
            </div>
        </div>
    </div>



    <!-- ===================== CLASSROOM LOGIC ===================== -->
    <script>
        const user = Auth.getUser();
        const accessList = user?.access ? user.access.toString().split(',').map(s => s.trim()) : [];
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('id');

        // Course + Lesson Database (Refactored with Prices & PDFs)
        const courseDB = {
            "1": {
                id: "1", title: "n8n Fundamentals", price: "0", handnote: "https://codewithpritom.blogspot.com/2026/02/bandit-level-31-walkthrough.html",
                lessons: [
                    { id: "1-1", title: "Welcome & Setup", video: "dQw4w9WgXcQ", duration: "8:24" },
                    { id: "1-2", title: "Understanding Nodes", video: "dQw4w9WgXcQ", duration: "12:10" },
                    { id: "1-3", title: "Triggers & Webhooks", video: "dQw4w9WgXcQ", duration: "15:32" },
                    { id: "1-4", title: "JSON & Data Flow", video: "dQw4w9WgXcQ", duration: "18:05" },
                    { id: "1-5", title: "Conditional Logic (IF/Switch)", video: "dQw4w9WgXcQ", duration: "14:48" },
                    { id: "1-6", title: "Loops & Iterations", video: "dQw4w9WgXcQ", duration: "11:22" },
                    { id: "1-7", title: "Error Handling", video: "dQw4w9WgXcQ", duration: "9:55" },
                    { id: "1-8", title: "Your First Workflow Project", video: "dQw4w9WgXcQ", duration: "20:30" }
                ]
            },
            "2": { // Missing price in prompt, assumed standard or free
                id: "2", title: "Advanced Webhooks & APIs", price: "39", handnote: "api-guide.pdf",
                lessons: [
                    { id: "2-1", title: "HTTP Request Basics", video: "M7lc1UVf-VE", duration: "10:15" },
                    { id: "2-2", title: "REST vs GraphQL", video: "M7lc1UVf-VE", duration: "14:30" },
                    { id: "2-3", title: "Authentication Methods", video: "M7lc1UVf-VE", duration: "18:45" },
                    { id: "2-4", title: "Webhook Security", video: "M7lc1UVf-VE", duration: "12:20" },
                    { id: "2-5", title: "Building a Payment Gateway", video: "M7lc1UVf-VE", duration: "22:10" },
                    { id: "2-6", title: "API Rate Limiting", video: "M7lc1UVf-VE", duration: "11:55" }
                ]
            },
            "3": {
                id: "3", title: "SaaS Automation Masterclass", price: "59", handnote: "saas-notes.pdf",
                lessons: [
                    { id: "3-1", title: "SaaS Architecture Overview", video: "jNQXAC9IVRw", duration: "15:00" },
                    { id: "3-2", title: "User Registration Flow", video: "jNQXAC9IVRw", duration: "20:30" },
                    { id: "3-3", title: "Payment Processing", video: "jNQXAC9IVRw", duration: "25:15" },
                    { id: "3-4", title: "Email Automation", video: "jNQXAC9IVRw", duration: "18:40" },
                    { id: "3-5", title: "Dashboard & Analytics", video: "jNQXAC9IVRw", duration: "22:10" },
                    { id: "3-6", title: "Deployment & Launch", video: "jNQXAC9IVRw", duration: "16:50" }
                ]
            },
            "4": {
                id: "4", title: "Linux Fundamentals", price: "49", handnote: "linux-fundamentals.pdf",
                lessons: [
                    { id: "4-1", title: "Linux History & Distros", video: "dQw4w9WgXcQ", duration: "10:00" },
                    { id: "4-2", title: "File Operations (ls, cp, mv)", video: "dQw4w9WgXcQ", duration: "15:00" },
                    { id: "4-3", title: "Permissions (chmod, chown)", video: "dQw4w9WgXcQ", duration: "20:00" }
                ]
            },
            "5": {
                id: "5", title: "C Programming Language", price: "59", handnote: "c-programming.pdf",
                lessons: [
                    { id: "5-1", title: "Hello World in C", video: "dQw4w9WgXcQ", duration: "5:00" },
                    { id: "5-2", title: "Variables & Data Types", video: "dQw4w9WgXcQ", duration: "12:00" },
                    { id: "5-3", title: "Pointers Explained", video: "dQw4w9WgXcQ", duration: "25:00" }
                ]
            },
            "6": {
                id: "6", title: "Discrete Mathematics", price: "49", handnote: "discrete-math.pdf",
                lessons: [
                    { id: "6-1", title: "Propositional Logic", video: "dQw4w9WgXcQ", duration: "18:00" },
                    { id: "6-2", title: "Set Theory", video: "dQw4w9WgXcQ", duration: "22:00" },
                    { id: "6-3", title: "Graph Theory Intro", video: "dQw4w9WgXcQ", duration: "30:00" }
                ]
            },
            "7": {
                id: "7", title: "Java Programming", price: "69", handnote: "java-basics.pdf",
                lessons: [
                    { id: "7-1", title: "Setting up JDK", video: "dQw4w9WgXcQ", duration: "8:00" },
                    { id: "7-2", title: "Java Syntax Basics", video: "dQw4w9WgXcQ", duration: "15:00" },
                    { id: "7-3", title: "Classes & Objects", video: "dQw4w9WgXcQ", duration: "20:00" }
                ]
            },
            "8": {
                id: "8", title: "Java OOP Mastery", price: "59", handnote: "java-oop.pdf",
                lessons: [
                    { id: "8-1", title: "Inheritance", video: "dQw4w9WgXcQ", duration: "18:00" },
                    { id: "8-2", title: "Polymorphism", video: "dQw4w9WgXcQ", duration: "16:00" },
                    { id: "8-3", title: "Encapsulation", video: "dQw4w9WgXcQ", duration: "14:00" }
                ]
            },
            "9": {
                id: "9", title: "Scripting & Automation", price: "49", handnote: "scripting-automation.pdf",
                lessons: [
                    { id: "9-1", title: "Python Basics", video: "dQw4w9WgXcQ", duration: "10:00" },
                    { id: "9-2", title: "Shell Scripting Intro", video: "dQw4w9WgXcQ", duration: "12:00" },
                    { id: "9-3", title: "Automating Tasks", video: "dQw4w9WgXcQ", duration: "25:00" }
                ]
            },
            "NEW_19": { id: "NEW_19", title: "Generated YouTube Course", price: "49", handnote: "", lessons: [ { id: "NEW_19-1", title: "Day 1 of Learning AI Agents in Hindi AI AGENTS Are Changing The Game !", video: "dhhVxJ_qUPc", duration: "10:00" }, { id: "NEW_19-2", title: "Day 2 Ai Agents Masterclass - What tools to use ?", video: "R2HsJuNr-ac", duration: "10:00" }, { id: "NEW_19-3", title: "Day 3 Ai Agents Masterclass - What if you Mastered Ai Agents in 2025 (Hindi)", video: "iQSZIOoe8P4", duration: "10:00" }, { id: "NEW_19-4", title: "Day 4 AI Agents Masterclass - 5 Types of nodes in N8n You need to KNOW", video: "a1eY8x8P09Y", duration: "10:00" }, { id: "NEW_19-5", title: "Day 5 - Building AI Agents Masterclass - Get Ready to build expert AI Agents - Hindi N8n Tutorial", video: "EHbAA8aERYc", duration: "10:00" }, { id: "NEW_19-6", title: "Day 6 - AI Agents Masterclass - Going more in-depth with nodes in Hindi", video: "9nckPa2EvRw", duration: "10:00" }, { id: "NEW_19-7", title: "Day 7 - Building A Agents Masterclass - WATCH THIS Even before you start building your first agent!", video: "fILw8-MYrvA", duration: "10:00" }, { id: "NEW_19-8", title: "Day 8 - AI Agents Masterclass - Lets Build a bit Complex Agent in Hindi", video: "ec5SwU5qj_k", duration: "10:00" }, { id: "NEW_19-9", title: "Day 8 Update Video on Day 8's Complex Workflow", video: "cyqleaWKWkA", duration: "10:00" }, { id: "NEW_19-10", title: "Day 9 Ai Agents Masterclass - n8n and Lovable - Power of webhooks", video: "umpPee57unw", duration: "10:00" }, { id: "NEW_19-11", title: "Day 10 Ai Agents Masterclass - n8n Email Reply Agent", video: "kg6YGlLF0Nk", duration: "10:00" }, { id: "NEW_19-12", title: "Day 11 Ai Agents Masterclass - MOST IMPORTANT VIDEO", video: "JOmWSuKP-Tg", duration: "10:00" }, { id: "NEW_19-13", title: "Day 12 Part 1 AI Agents Masterclass - CREATING WORKFLOW WITHOUT JSON", video: "VhxYxKOPMr4", duration: "10:00" }, { id: "NEW_19-14", title: "Day 12 Part 2 AI Agents Masterclass - SUPERPOWER FOR YOUR AI AGENTS", video: "p1eW2_XZleo", duration: "10:00" }, { id: "NEW_19-15", title: "Day 12 Part 3 AI Agents Masterclass - Spent 30 Days using JSON's and it chnaged my life", video: "D6rtkyArbYA", duration: "10:00" }, { id: "NEW_19-16", title: "Day 13 AI Agents Masterclass - Data Processing in N8n in Hindi", video: "aNHHr1IjsEk", duration: "10:00" }, { id: "NEW_19-17", title: "Day 14 AI Agents Masterclass - What is RAG and why it Matters", video: "ERg2my7c8SA", duration: "10:00" }, { id: "NEW_19-18", title: "Day 15 Part 1 AI Agents Masterclass - What is RAG, Embedding and Vectors", video: "Rohm5agdQn8", duration: "10:00" }, { id: "NEW_19-19", title: "Day 15 - Build your First RAG Agent in Hindi", video: "NTwM3V-mdzc", duration: "10:00" }, { id: "NEW_19-20", title: "How MCP Makes your AI Agents Super Smart â€” Explained in Detail â€” In Hindi", video: "P7hcFHVu-xs", duration: "10:00" }, { id: "NEW_19-21", title: "DAY 16 - Building Your First Voice AI Agent - Simplest Way HINDI", video: "MOj0mtInC84", duration: "10:00" } ] },
        };

        // DOM Elements
        const wrapper = document.getElementById('video-wrapper');
        const lockScreen = document.getElementById('lock-screen');
        const titleEl = document.getElementById('course-title');
        const metaEl = document.getElementById('course-meta');
        const sidebarTitle = document.getElementById('sidebar-course-title');
        const lessonList = document.getElementById('lesson-list');
        const lessonCounter = document.getElementById('lesson-counter');
        const videoLoader = document.getElementById('video-loader');
        const completeBar = document.getElementById('complete-bar');
        const btnComplete = document.getElementById('btn-mark-complete');
        const completeBtnText = document.getElementById('complete-btn-text');
        const completeStatus = document.getElementById('complete-status');
        const btnPrev = document.getElementById('btn-prev-lesson');
        const btnNext = document.getElementById('btn-next-lesson');

        // Set user initial & prefill checkout
        if (user) {
            document.getElementById('cl-user-initial').textContent = (user?.name || 'U').charAt(0).toUpperCase();

            // Prefill checkout if fields exist
            const nameF = document.getElementById('bill-name');
            const emailF = document.getElementById('bill-email');
            if (nameF) nameF.value = user.name || '';
            if (emailF) emailF.value = user.email || '';
        }

        let currentLessonIndex = 0;

        // ===== PROGRESS TRACKING =====
        function getProgressKey() {
            return `cwp-progress-${courseId}`;
        }

        function getCompletedLessons() {
            try {
                return JSON.parse(localStorage.getItem(getProgressKey()) || '[]');
            } catch { return []; }
        }

        function isLessonCompleted(index) {
            return getCompletedLessons().includes(index);
        }

        function getProgressPercent(course) {
            const completed = getCompletedLessons();
            return Math.round((completed.length / course.lessons.length) * 100);
        }

        function updateProgressUI(course) {
            const pct = getProgressPercent(course);
            const completed = getCompletedLessons();

            // Header progress
            const hBar = document.getElementById('header-progress-bar');
            const hText = document.getElementById('header-progress-text');
            if (hBar) hBar.style.width = pct + '%';
            if (hText) hText.textContent = pct + '%';

            // Sidebar progress
            const sBar = document.getElementById('sidebar-progress-fill');
            const sText = document.getElementById('sidebar-progress-text');
            if (sBar) sBar.style.width = pct + '%';
            if (sText) sText.textContent = `${completed.length}/${course.lessons.length} (${pct}%)`;

            // Complete bar status
            if (completeStatus) {
                completeStatus.textContent = `${completed.length} of ${course.lessons.length} completed`;
            }

            // Update course meta
            if (metaEl) metaEl.textContent = `${course.lessons.length} Lessons Â· ${pct}% complete`;
        }

        // ===== MARK AS COMPLETE =====
        function markComplete() {
            const course = courseDB[courseId];
            if (!course) return;

            let completed = getCompletedLessons();
            const alreadyDone = completed.includes(currentLessonIndex);

            if (alreadyDone) {
                // Uncomplete (toggle off)
                completed = completed.filter(i => i !== currentLessonIndex);
                localStorage.setItem(getProgressKey(), JSON.stringify(completed));
                updateCompleteButton(false);
                UI.showToast('Lesson unmarked.', 'info');
            } else {
                // Mark complete
                completed.push(currentLessonIndex);
                localStorage.setItem(getProgressKey(), JSON.stringify(completed));
                updateCompleteButton(true);

                // Check if all lessons done
                if (completed.length === course.lessons.length) {
                    UI.showToast('ðŸŽ‰ Course 100% Complete! Amazing!', 'success');
                    launchConfetti();
                } else {
                    UI.showToast('âœ… Lesson completed!', 'success');
                }
            }

            // Refresh UI
            renderLessons(course);
            updateProgressUI(course);
        }

        function updateCompleteButton(isDone) {
            if (isDone) {
                btnComplete.classList.add('completed');
                completeBtnText.textContent = 'âœ“ Completed';
                btnComplete.querySelector('i').className = 'fa-solid fa-check-double';
            } else {
                btnComplete.classList.remove('completed');
                completeBtnText.textContent = 'Mark as Complete';
                btnComplete.querySelector('i').className = 'fa-solid fa-check-circle';
            }
        }

        // ===== CONFETTI =====
        function launchConfetti() {
            const colors = ['#10b981', '#f97316', '#6366f1', '#ec4899', '#eab308', '#3b82f6'];
            for (let i = 0; i < 40; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 1.5 + 's';
                piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                piece.style.width = (6 + Math.random() * 8) + 'px';
                piece.style.height = (6 + Math.random() * 8) + 'px';
                document.body.appendChild(piece);
                setTimeout(() => piece.remove(), 4000);
            }
        }

        // ===== NAVIGATION =====
        function nextLesson() {
            const course = courseDB[courseId];
            if (currentLessonIndex < course.lessons.length - 1) {
                loadLesson(currentLessonIndex + 1, course);
            }
        }

        function prevLesson() {
            const course = courseDB[courseId];
            if (currentLessonIndex > 0) {
                loadLesson(currentLessonIndex - 1, course);
            }
        }

        // ===== RENDER =====
        function renderLessons(course) {
            const completed = getCompletedLessons();
            lessonList.innerHTML = '';
            course.lessons.forEach((lesson, idx) => {
                const isActive = idx === currentLessonIndex;
                const isDone = completed.includes(idx);
                lessonList.innerHTML += `
                    <button onclick="loadLesson(${idx}, courseDB['${courseId}'])" 
                        class="lesson-item ${isActive ? 'active' : ''}" id="lesson-btn-${idx}">
                        <div class="lesson-icon ${isActive ? 'bg-orange-600 text-white' : isDone ? 'bg-green-600 text-white' : 'bg-gray-700 text-gray-400'}">
                            ${isActive
                        ? '<i class="fa-solid fa-play text-[10px]"></i>'
                        : isDone
                            ? '<i class="fa-solid fa-check text-[10px]"></i>'
                            : `<span class="text-xs font-bold">${idx + 1}</span>`
                    }
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="text-sm font-medium truncate ${isDone && !isActive ? 'line-through opacity-60' : ''}">${lesson.title}</div>
                            <div class="text-xs text-gray-500 mt-0.5">${lesson.duration}</div>
                        </div>
                        ${isDone ? '<div class="lesson-check check-pop"><i class="fa-solid fa-check text-[8px]"></i></div>' : ''}
                    </button>
                `;
            });

            // Render Hand Notes in Sidebar
            const notesSection = document.getElementById('handnotes-section');
            const notesList = document.getElementById('handnotes-list');
            if (course.handnote) {
                notesSection.classList.remove('hidden');
                notesList.innerHTML = `
                    <div class="handnote-item" onclick="openHandnote('${course.handnote}')">
                        <i class="fa-solid fa-file-lines text-orange-500 text-xl"></i>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-300">Course Hand Note</div>
                            <div class="text-xs text-gray-500">Resource Link</div>
                        </div>
                        <i class="fa-solid fa-arrow-up-right-from-square text-gray-500 text-xs"></i>
                    </div>
                `;
            } else {
                notesSection.classList.add('hidden');
            }
        }

        function loadLesson(index, course) {
            currentLessonIndex = index;
            const lesson = course.lessons[index];

            // Update video
            wrapper.innerHTML = `<iframe class="w-full h-full" src="https://www.youtube.com/embed/${lesson.video}?autoplay=1&modestbranding=1&rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
            videoLoader.style.display = 'none';

            // Update header
            lessonCounter.textContent = `Lesson ${index + 1} of ${course.lessons.length}`;
            document.title = `${lesson.title} | Code With Pritom`;

            // Show/hide nav buttons
            btnPrev.style.display = index > 0 ? 'inline-flex' : 'none';
            btnNext.style.display = index < course.lessons.length - 1 ? 'inline-flex' : 'none';

            // Update complete button state
            updateCompleteButton(isLessonCompleted(index));

            // Re-render lesson list
            renderLessons(course);
            updateProgressUI(course);

            // Load saved notes
            loadNotes();

            // Scroll active lesson into view in sidebar
            setTimeout(() => {
                const activeBtn = document.getElementById(`lesson-btn-${index}`);
                if (activeBtn) activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // ===== HANDNOTE VIEWER =====
        function openHandnote(link) {
            if (!link) return;
            // If it starts with http, open directly
            if (link.trim().startsWith('http')) {
                window.open(link, '_blank');
            } else {
                // Legacy PDF filename support
                window.open(`/api/handnotes/${link}`, '_blank');
            }
        }

        // ===== INIT =====
        if (courseDB[courseId]) {
            const course = courseDB[courseId];
            const isUnlocked = accessList.includes(courseId);

            titleEl.textContent = course.title;
            sidebarTitle.textContent = course.title;
            document.title = `${course.title} | Code With Pritom`;

            if (isUnlocked) {
                completeBar.style.display = 'flex';
                document.getElementById('course-progress-badge').classList.remove('hidden');
                renderLessons(course);
                loadLesson(0, course);
                updateProgressUI(course);
            } else {
                lockScreen.classList.remove('hidden');
                wrapper.innerHTML = '';
                videoLoader.style.display = 'none';
                metaEl.textContent = `${course.lessons.length} Lessons Â· Locked`;

                course.lessons.forEach(lesson => {
                    lessonList.innerHTML += `
                        <div class="lesson-item locked">
                            <div class="lesson-icon bg-gray-700 text-gray-500"><i class="fa-solid fa-lock text-[10px]"></i></div>
                            <div class="flex-1">
                                <div class="text-sm text-gray-500">${lesson.title}</div>
                                <div class="text-xs text-gray-600 mt-0.5">${lesson.duration}</div>
                            </div>
                        </div>
                    `;
                });
            }
        } else {
            titleEl.textContent = 'Course Not Found';
            metaEl.textContent = 'This course does not exist.';
            lockScreen.classList.remove('hidden');
            videoLoader.style.display = 'none';
            wrapper.innerHTML = '';
            // Hide purchase button if course not found
            const btn = lockScreen.querySelector('.btn-primary');
            if (btn) btn.style.display = 'none';
        }

        // ===== NOTES =====
        function saveNotes() {
            const notes = document.getElementById('lesson-notes').value;
            localStorage.setItem(`notes-${courseId}-${currentLessonIndex}`, notes);
            UI.showToast('âœ“ Notes saved!', 'success');
        }

        function loadNotes() {
            const notes = localStorage.getItem(`notes-${courseId}-${currentLessonIndex}`) || '';
            document.getElementById('lesson-notes').value = notes;
        }

        loadNotes();

        // ===== MOBILE SIDEBAR TOGGLE =====
        function toggleClassroomSidebar() {
            const sidebar = document.getElementById('classroom-sidebar');
            const overlay = document.getElementById('classroom-sidebar-overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        function closeClassroomSidebar() {
            const sidebar = document.getElementById('classroom-sidebar');
            const overlay = document.getElementById('classroom-sidebar-overlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('open');
        }
    </script>
</body>

</html>